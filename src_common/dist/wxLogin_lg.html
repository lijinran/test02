<!DOCTYPE html><html lang="en"><head><title>微信登录</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style>.field-tooltipWrap{position:absolute;left:0;top:0;width:100%;z-index:19891014}.field-tooltipInner{pointer-events:none;display:table;position:fixed;left:0;top:0;width:100%;height:100%}.field-tooltip{display:table-cell;vertical-align:middle;text-align:center}.field-tooltip .field-invalidmsg,.field-tooltip .field-validmsg{color:#fff}.field-tooltip .zvalid-resultformat{display:inline-block;position:relative;background-color:rgba(0,0,0,.8);color:#fff;padding:10px 15px;font-size:14px;border-radius:6px;box-shadow:0 0 8px rgba(0,0,0,.1);pointer-events:auto;animation-name:fieldTipBounceIn;-webkit-animation-name:fieldTipBounceIn;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:.18s;animation-duration:.18s}@-webkit-keyframes fieldTipBounceIn{0%{opacity:0;-webkit-transform:scale3d(.3,.3,.3);transform:scale3d(.3,.3,.3)}100%{opacity:1;-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1)}}</style></head><body><div id="message"></div><script src="config.js"></script><script>function createXHR(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(!window.ActiveXObject)throw new Error("浏览器不支持XHR对象！");for(var e=0,t=["MSXML2.XMLHttp","Microsoft.XMLHTTP"].length;e<t;e++)try{return new ActiveXObject(version[e])}catch(e){}}function pajax(e){var t=createXHR();function a(){200==t.status?e.success(JSON.parse(t.responseText)):e.fail(JSON.parse(t.responseText))}e.url=e.url+"?rand="+Math.random(),e.data=params(e.data),"get"===e.method&&(e.url+=-1==e.url.indexOf("?")?"?"+e.data:"&"+e.data),!0===e.async&&(t.onreadystatechange=function(){4==t.readyState&&a()}),t.open(e.method,e.url,e.async),"post"===e.method?(t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(e.data)):t.send(null),!1===e.async&&a()}function params(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")}function getQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(t);return null!=a?a[2]:""}function getMessage(e){var t=document.getElementById("message"),a='<div class="field-tooltipWrap"><div class="field-tooltipInner"><div class="field-tooltip fieldTipBounceIn"><div class="zvalid-resultformat">'+e+"</div></div></div></div>";t.innerHTML=a,setTimeout(function(){t.innerHTML=""},1500)}var host=config.HOST,wxuserInfo="/cloud2.member.api/wx/userInfoSC.do",wxLogin="/cloud2.member.api/member/userInfo/wxLogin.do",loddproject=window.localStorage.getItem("project")||"_jtz201804_",barData=window.sessionStorage.getItem(loddproject+"barcodeData"),wxcode=getQueryString("code");function wxDologin(e){pajax({url:host+wxLogin,method:"post",data:{openId:e.openid,comId:barData.comId,nickname:e.nickname,sex:e.sex,accessToken:e.access_token,refreshToken:e.refresh_token,headImgUrl:e.headimgurl,province:e.province,city:e.city,unionId:e.unionid,materialsId:barData.product_id,provinceUser:barData.province,cityUser:barData.city,barcode:barData.barcode},success:function(e){if(200==e.code)return window.localStorage.setItem(loddproject+"wxLogin",JSON.stringify(e.data)),window.location.href=loddproject+"/loading.html",!1;e.msg&&getMessage(e.msg)},fail:function(e){getMessage("网络错误")},async:!0})}(barData=JSON.parse(barData))||getMessage("请重新扫码"),wxcode?pajax({url:host+wxuserInfo,method:"get",data:{code:wxcode},success:function(e){200==e.code?(window.localStorage.setItem(loddproject+"wxInfo",JSON.stringify(e.data)),e.data?wxDologin(e.data):getMessage("没有用户信息")):e.msg&&getMessage(e.msg)},fail:function(e){getMessage("网络错误")},async:!0}):getMessage("微信授权参数不正确")</script></body></html>